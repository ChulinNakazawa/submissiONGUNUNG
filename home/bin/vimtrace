#!/usr/bin/env python3

'''strace wrapper'''

import os
import sys
import subprocess
import signal

def sigchld(signo, sigframe):
  pass

def main():
  tracer = sys.argv[1]
  if tracer not in ('strace', 'ltrace'):
    sys.exit('%s not supported.' % tracer)

  vim = subprocess.Popen(
    ["vim", "+set buftype=nofile", "+setf strace", "-"],
    preexec_fn = os.setpgrp,
    stdin = subprocess.PIPE,
  )
  fd = vim.stdin.fileno()
  tracerp = subprocess.Popen(
    [tracer, '-o', '/proc/self/fd/%s' % fd] + sys.argv[2:],
    pass_fds=(fd,),
  )
  while True:
    try:
      x = tracerp.wait()
    except KeyboardInterrupt:
      continue
    vim.stdin.close()
    break

  # ignore SIGTTOU so that we can fg ourself
  signal.signal(sig