#!/usr/bin/env ruby
# Gmail: More -> Export -> Google CSV
require 'csv'

pinyin_initial = {}
File.open(File.expand_path '~/.vim/bundle/vim-PinyinSearch/PinyinSearch.dict') {|h|
  while l = h.gets
    fs = l.split
    if fs.size == 2
      pinyin_initial[fs[0]] = fs[1]
    end
  end
}
to_pinyin = ->s {
  s[/ /] ? '' : s.chars.map {|c| pinyin_initial.fetch c, c }.join
}

# Google CSV
## remove/rename columns
google = CSV.read(ARGV[0] || '/tmp/google.csv', encoding: 'bom|utf-16').map {|l| l.map {|c| c and c.en